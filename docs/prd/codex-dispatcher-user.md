# PRD: Codex Task Dispatcher (ç”¨æˆ·ç‰ˆ)

> ç‰ˆæœ¬: 3.0 | æ—¥æœŸ: 2026-02-09 | çŠ¶æ€: è¿›è¡Œä¸­

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 å®šä½
æ„å»ºä¸€ä¸ª **ä¸‰æ–¹åä½œçš„ AI é¡¹ç›®ç®¡ç†ç³»ç»Ÿ**ï¼Œè®©å¼€å‘å·¥ä½œåƒæµæ°´çº¿ä¸€æ ·è‡ªåŠ¨è¿è½¬ï¼š

| è§’è‰² | å®ä½“ | èŒè´£ |
|------|------|------|
| **ç”¨æˆ· (User)** | æ‚¨ | æéœ€æ±‚ã€ç¡®è®¤ PRDã€å¤„ç†é‡å¤§é—®é¢˜ |
| **é¡¹ç›®ç»ç† (PM)** | Antigravity | åˆ†è§£éœ€æ±‚ã€è°ƒåº¦ä»»åŠ¡ã€å›ç­”é—®é¢˜ã€æ›´æ–°è¿›åº¦ã€**è‡ªä¸»å†³ç­–** |
| **å·¥ç¨‹å¸ˆ (Worker)** | Codex | æ‰§è¡ŒåŸå­ä»»åŠ¡ã€æ±‡æŠ¥ç»“æœã€æå‡ºé—®é¢˜ |

### 1.2 æ ¸å¿ƒç†å¿µ

> **"æ‚¨åªéœ€è¦è¯´éœ€æ±‚ï¼Œç„¶åå»ç¡è§‰ã€‚é†’æ¥æ—¶ï¼Œä»£ç å·²ç»å†™å¥½äº†ã€‚"**

- **æœ€å°æ‰“æ‰°åŸåˆ™**ï¼šPM èƒ½å†³å®šçš„äº‹æƒ…ï¼ŒPM ç›´æ¥å†³å®šã€‚ä»…åœ¨é‡å¤§æˆ–éš¾ä»¥æŠ‰æ‹©çš„é—®é¢˜ä¸Šæ‰ä¼šæ‰“æ‰°æ‚¨ã€‚
- **æ™ºèƒ½è·³è¿‡åŸåˆ™**ï¼šå¦‚æœæŸä¸ªä»»åŠ¡è¢«é˜»å¡ï¼ˆç­‰å¾…æ‚¨å›å¤ä½†æ‚¨ä¸åœ¨ï¼‰ï¼ŒPM ä¼šä¼˜å…ˆæ‰§è¡Œå…¶ä»–æ— å…³ä»»åŠ¡ï¼Œè€Œä¸æ˜¯å‚»ç­‰ã€‚
- **ä¸Šä¸‹æ–‡éš”ç¦»åŸåˆ™**ï¼šæ¯ä¸ª Worker æ‹¥æœ‰å…¨æ–°çš„ä¸Šä¸‹æ–‡çª—å£ï¼Œå½»åº•æœç»ä»»åŠ¡é—´çš„å¹»è§‰æ±¡æŸ“ã€‚

---

## 2. æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | æè¿° | ä¼˜åŠ¿ |
|-----|------|------|
| **ä¸‰æ–¹åä½œ** | User â†’ PM â†’ Worker çš„æ¸…æ™°èŒè´£é“¾ | æ¨¡æ‹ŸçœŸå®å›¢é˜Ÿï¼Œå¯è¿½æº¯ |
| **äº¤äº’å¼è°ƒåº¦** | PM ç›‘æ§ Worker è¿›ç¨‹ï¼Œå®æ—¶å“åº”é—®é¢˜ | ä¸æ˜¯ "Fire and Forget" |
| **è‡ªä¸»å†³ç­–** | PM ä¼˜å…ˆè‡ªè¡Œåˆ¤æ–­å¸¸è§é—®é¢˜ | å‡å°‘æ‰“æ‰°ç”¨æˆ· |
| **æ™ºèƒ½è·³è¿‡** | é˜»å¡ä»»åŠ¡ä¸é˜»å¡æ•´ä½“è¿›åº¦ | æ‚¨ç¡è§‰æ—¶å·¥ä½œä»ç»§ç»­ |
| **ä¸Šä¸‹æ–‡éš”ç¦»** | æ¯ä¸ªä»»åŠ¡ç”±ç‹¬ç«‹ Worker æ‰§è¡Œ | æœç»å¹»è§‰æ±¡æŸ“ |
| **å•ä¸€çœŸå®æº** | PRD å³è¿›åº¦è¡¨ï¼Œå®æ—¶æ›´æ–° | æ— éœ€ç»´æŠ¤é¢å¤–çŠ¶æ€ |

---

## 3. å…³é”®è®¾è®¡å†³ç­–

| å†³ç­–ç‚¹ | é€‰æ‹© | ç†ç”± |
|-------|------|-----|
| è°ƒåº¦æ¨¡å¼ | **äº¤äº’å¼** (éè„šæœ¬) | PM å¯ä»‹å…¥ã€å¯å›ç­”é—®é¢˜ã€å¯è·³è¿‡ |
| Worker å·¥å…· | Codex CLI | å“åº”å¿«ï¼Œæ”¯æŒéš”ç¦»æ‰§è¡Œ |
| æ‰§è¡Œæ¨¡å¼ | ä¸²è¡Œï¼ˆv2.0 å¯æ‰©å±•å¹¶è¡Œï¼‰ | ç®€åŒ–ä¾èµ–ç®¡ç† |
| å¤±è´¥ç­–ç•¥ | æ™ºèƒ½é‡è¯• 3 æ¬¡ â†’ æ ‡è®° BLOCKED | å¹³è¡¡è‡ªåŠ¨åŒ–ä¸å®‰å…¨æ€§ |
| é—®é¢˜å“åº” | PM ä¼˜å…ˆå›ç­” â†’ ä¸ç¡®å®šåˆ™è¯¢é—® User | æœ€å°æ‰“æ‰°åŸåˆ™ |
| é˜»å¡å¤„ç† | è·³è¿‡ â†’ æ‰§è¡Œå…¶ä»–ä»»åŠ¡ | ä¿æŒæ•´ä½“è¿›åº¦ |

---

## 4. å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Phase 1: éœ€æ±‚å¯¹é½                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [User] æå‡ºéœ€æ±‚                                              â”‚
â”‚     â†“                                                        â”‚
â”‚  [PM] åˆ†è§£éœ€æ±‚ï¼Œç”Ÿæˆ PRD (ç”¨æˆ·ç‰ˆ + ç ”å‘ç‰ˆ)                     â”‚
â”‚     â†“                                                        â”‚
â”‚  [User] ç¡®è®¤ PRD â†’ "Go"                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              |
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Phase 2: ä»»åŠ¡è°ƒåº¦                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [PM] è¯»å– PRD â†’ è¯†åˆ«ç¬¬ä¸€ä¸ª PENDING ä»»åŠ¡ (T-001)              â”‚
â”‚     â†“                                                        â”‚
â”‚  [PM] å¯åŠ¨ Codex Worker (åå°è¿›ç¨‹ï¼Œå…¨æ–°ä¸Šä¸‹æ–‡)                 â”‚
â”‚     â†“                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Worker æ‰§è¡Œä¸­ (PM æŒç»­ç›‘æ§)                  â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  [Worker] ç¼–å†™ä»£ç ã€è¿è¡Œæµ‹è¯•...                          â”‚ â”‚
â”‚  â”‚  [Worker] é‡åˆ°é—®é¢˜ â†’ è¾“å‡ºç–‘é—®                            â”‚ â”‚
â”‚  â”‚     â†“                                                   â”‚ â”‚
â”‚  â”‚  [PM] æ£€æµ‹åˆ°é—®é¢˜ â†’ åˆ¤æ–­:                                 â”‚ â”‚
â”‚  â”‚     â”œâ”€ æˆ‘èƒ½å›ç­” â†’ ç›´æ¥å›å¤ Worker                        â”‚ â”‚
â”‚  â”‚     â””â”€ æˆ‘ä¸ç¡®å®š â†’ è¯¢é—® User (æˆ–æ ‡è®° BLOCKED è·³è¿‡)         â”‚ â”‚
â”‚  â”‚     â†“                                                   â”‚ â”‚
â”‚  â”‚  [Worker] æ”¶åˆ°å›å¤ â†’ ç»§ç»­æ‰§è¡Œ                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚     â†“                                                        â”‚
â”‚  [Worker] ä»»åŠ¡å®Œæˆ â†’ æ±‡æŠ¥ç»“æœ                                 â”‚
â”‚     â†“                                                        â”‚
â”‚  [PM] æ›´æ–° PRD çŠ¶æ€ (T-001 â†’ âœ… DONE)                         â”‚
â”‚     â†“                                                        â”‚
â”‚  è¿˜æœ‰ä»»åŠ¡? â”€Yesâ”€â†’ å›åˆ° "è¯†åˆ«ä¸‹ä¸€ä¸ªä»»åŠ¡"                       â”‚
â”‚     â”‚                                                        â”‚
â”‚     No                                                       â”‚
â”‚     â†“                                                        â”‚
â”‚  ğŸ‰ æ‰€æœ‰ä»»åŠ¡å®Œæˆ                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. PM â†” Worker é€šä¿¡æœºåˆ¶

### 5.1 æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            PM (Antigravity)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ ä»»åŠ¡è°ƒåº¦å™¨   â”‚    â”‚ è¾“å‡ºç›‘æ§å™¨   â”‚    â”‚  é—®é¢˜å¤„ç†å™¨  â”‚                  â”‚
â”‚  â”‚ (Scheduler) â”‚    â”‚ (Monitor)   â”‚    â”‚  (Handler)  â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚         â”‚                  â”‚                  â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                  â”‚
          â”‚ codex exec       â”‚ è½®è¯¢ stdout      â”‚ stdin æˆ– é‡å¯
          â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Worker (Codex CLI)                               â”‚
â”‚                                                                          â”‚
â”‚   [å…¨æ–°ä¸Šä¸‹æ–‡] â†’ è¯»å–ä»»åŠ¡ Prompt â†’ æ‰§è¡Œ â†’ è¾“å‡ºç»“æœ                          â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 å¯åŠ¨ Worker

PM é€šè¿‡ Codex CLI å¯åŠ¨ç‹¬ç«‹ Workerï¼š

```bash
codex exec --prompt "ä»»åŠ¡æè¿°..." --approval-mode full-auto
```

- `--approval-mode full-auto`: Worker è‡ªåŠ¨æ‰§è¡Œï¼Œæ— éœ€äººå·¥æ‰¹å‡†
- æ¯æ¬¡å¯åŠ¨éƒ½æ˜¯**å…¨æ–°ä¸Šä¸‹æ–‡**ï¼Œæ— å†å²æ±¡æŸ“

### 5.3 ç›‘æ§ Worker è¾“å‡º

PM å®æ—¶è¯»å– Worker çš„ stdoutï¼Œè¯†åˆ«ç»“æ„åŒ–æ ‡ç­¾ï¼š

| æ ‡ç­¾ | å«ä¹‰ | PM å“åº” |
|-----|------|--------|
| `[PROGRESS]` | è¿›åº¦æ›´æ–° | è®°å½•ï¼Œæ›´æ–°å¯è§†åŒ– |
| `[QUESTION]` | Worker æœ‰é—®é¢˜ | åˆ¤æ–­åå›å¤æˆ–æ ‡è®° BLOCKED |
| `[DONE]` | ä»»åŠ¡å®Œæˆ | æ›´æ–° PRD çŠ¶æ€ï¼Œè°ƒåº¦ä¸‹ä¸€ä¸ª |
| `[ERROR]` | æ‰§è¡Œå¤±è´¥ | åˆ†æåŸå› ï¼Œå†³å®šé‡è¯•æˆ– BLOCKED |

### 5.4 å‘ Worker å‘é€å›å¤

> âœ… **æŠ€æœ¯é¢„ç ”ç»“è®º (2026-02-09)**: Codex `exec` æ¨¡å¼ä¸ºéäº¤äº’å¼ï¼Œè¿è¡Œä¸­æ— æ³•æ¥æ”¶ stdin è¾“å…¥ã€‚é‡‡ç”¨"é‡å¯æ³¨å…¥"æ–¹æ¡ˆã€‚

**é‡å¯æ³¨å…¥æœºåˆ¶**ï¼š
1. PM æ£€æµ‹åˆ° Worker è¾“å‡ºé—®é¢˜ (é€šè¿‡ `--json` äº‹ä»¶æµ)
2. PM ç»ˆæ­¢å½“å‰ Worker è¿›ç¨‹
3. PM åœ¨åŸå§‹ Prompt å°¾éƒ¨è¿½åŠ é—®é¢˜ç­”æ¡ˆï¼š
   ```
   [åŸå§‹ä»»åŠ¡ Prompt]
   
   ---
   [è¡¥å……ä¿¡æ¯] å…³äºä½ ä¹‹å‰çš„é—®é¢˜ "XXX"ï¼Œç­”æ¡ˆæ˜¯: YYY
   ```
4. PM é‡æ–°å¯åŠ¨ Workerï¼ŒWorker åœ¨æ–°ä¸Šä¸‹æ–‡ä¸­ç»§ç»­æ‰§è¡Œ

### 5.5 è¶…æ—¶ç­–ç•¥

| ä»»åŠ¡ç±»å‹ | è¶…æ—¶æ—¶é—´ | å¤„ç†æ–¹å¼ |
|---------|---------|---------|
| ä»£ç ä¿®æ”¹ | 10 åˆ†é’Ÿ | è¶…æ—¶å BLOCKED |
| æµ‹è¯•æ‰§è¡Œ | 15 åˆ†é’Ÿ | è¶…æ—¶å BLOCKED |
| æ„å»ºä»»åŠ¡ | 20 åˆ†é’Ÿ | è¶…æ—¶å BLOCKED |

**æ³¨**: è¶…æ—¶å PM è®°å½•æœ€åè¾“å‡ºï¼Œä¾› User åˆ†æã€‚

---

## 6. ä»»åŠ¡çŠ¶æ€æœº

### 6.1 çŠ¶æ€å®šä¹‰

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                         â”‚
                    â–¼                                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”
â”‚ PENDING â”‚â”€â”€â”€â–¶â”‚ IN_PROGRESS â”‚â”€â”€â”€â–¶â”‚  DONE   â”‚           â”‚  RETRY  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚              â”‚                                         â–²
     â”‚              â”‚ å¤±è´¥/é—®é¢˜                                â”‚
     â”‚              â–¼                                         â”‚
     â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      User å›å¤å                   â”‚
     â”‚         â”‚ BLOCKED â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚              â”‚
     â”‚              â”‚ 3 æ¬¡é‡è¯•å¤±è´¥
     â”‚              â–¼
     â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚         â”‚ FAILED  â”‚
     â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ ä¾èµ–æœªæ»¡è¶³
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SKIPPED â”‚ (ä¸´æ—¶è·³è¿‡ï¼Œå¾…ä¾èµ–å®Œæˆåæ¢å¤)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 çŠ¶æ€è¯´æ˜

| çŠ¶æ€ | å›¾æ ‡ | è¯´æ˜ |
|-----|------|-----|
| PENDING | â³ | ç­‰å¾…æ‰§è¡Œ |
| IN_PROGRESS | ğŸ”„ | æ­£åœ¨æ‰§è¡Œä¸­ |
| DONE | âœ… | å·²å®Œæˆ |
| BLOCKED | ğŸš« | éœ€è¦ User ä»‹å…¥ |
| RETRY | ğŸ” | ç­‰å¾…é‡è¯• (è‡ªåŠ¨) |
| FAILED | âŒ | å¤±è´¥ (éœ€äººå·¥å¤„ç†) |
| SKIPPED | â­ï¸ | ä¸´æ—¶è·³è¿‡ |

### 6.3 çŠ¶æ€æµè½¬è§„åˆ™

| å½“å‰çŠ¶æ€ | è§¦å‘æ¡ä»¶ | ç›®æ ‡çŠ¶æ€ |
|---------|---------|---------|
| PENDING | PM å¼€å§‹è°ƒåº¦ | IN_PROGRESS |
| PENDING | ä¾èµ–ä»»åŠ¡ BLOCKED | SKIPPED |
| IN_PROGRESS | Worker å®Œæˆ | DONE |
| IN_PROGRESS | Worker æé—® (PM èƒ½ç­”) | IN_PROGRESS (ç»§ç»­) |
| IN_PROGRESS | Worker æé—® (PM ä¸ç¡®å®š) | BLOCKED |
| IN_PROGRESS | Worker å¤±è´¥ (å¯é‡è¯•) | RETRY |
| IN_PROGRESS | è¶…æ—¶ | BLOCKED |
| BLOCKED | User å›å¤ | RETRY |
| RETRY | é‡è¯•æˆåŠŸ | DONE |
| RETRY | é‡è¯• 3 æ¬¡ä»å¤±è´¥ | FAILED |
| SKIPPED | ä¾èµ–ä»»åŠ¡å®Œæˆ | PENDING |

---

## 7. Worker è¾“å‡ºåè®®

> âœ… **æŠ€æœ¯é¢„ç ”ç»“è®º (2026-02-09)**: Codex CLI åŸç”Ÿæ”¯æŒ `--json` JSONL äº‹ä»¶æµè¾“å‡ºï¼Œæ— éœ€è‡ªå®šä¹‰æ ‡ç­¾ã€‚

### 7.1 å¯åŠ¨å‘½ä»¤

```bash
codex exec --json --full-auto --output-last-message result.md "ä»»åŠ¡æè¿°..."
```

| å‚æ•° | ä½œç”¨ |
|-----|------|
| `--json` | è¾“å‡º JSONL æ ¼å¼äº‹ä»¶æµ |
| `--full-auto` | å…¨è‡ªåŠ¨æ¨¡å¼ï¼Œæ— éœ€äººå·¥æ‰¹å‡† |
| `--output-last-message` | å°†æœ€ç»ˆæ¶ˆæ¯å†™å…¥æ–‡ä»¶ |
| `--output-schema` | (å¯é€‰) çº¦æŸæœ€ç»ˆå“åº”æ ¼å¼ |

### 7.2 JSONL äº‹ä»¶ç±»å‹

PM å®æ—¶è§£æ Worker çš„ stdout JSONL äº‹ä»¶æµï¼š

| äº‹ä»¶ç±»å‹ | è¯´æ˜ | PM å“åº” |
|---------|------|--------|
| `agent_message` | Agent è¾“å‡ºæ¶ˆæ¯ | è®°å½•è¿›åº¦ |
| `tool_call` | è°ƒç”¨å·¥å…· (shell, file_write ç­‰) | ç›‘æ§æ‰§è¡Œ |
| `tool_result` | å·¥å…·æ‰§è¡Œç»“æœ | æ£€æŸ¥æˆåŠŸ/å¤±è´¥ |
| `error` | å‘ç”Ÿé”™è¯¯ | åˆ¤æ–­é‡è¯•æˆ– BLOCKED |
| `session_end` | ä¼šè¯ç»“æŸ | æ›´æ–° PRD çŠ¶æ€ |

### 7.3 PM äº‹ä»¶å¤„ç†æµç¨‹

```python
# ä¼ªä»£ç 
process = subprocess.Popen(
    ["codex", "exec", "--json", "--full-auto", prompt],
    stdout=subprocess.PIPE
)

for line in process.stdout:
    event = json.loads(line)
    
    match event["type"]:
        case "agent_message":
            content = event["content"]
            # æ£€æŸ¥æ˜¯å¦åŒ…å«æé—®è¯­ä¹‰
            if is_question(content):
                if pm_can_answer(content):
                    process.terminate()
                    new_prompt = original_prompt + f"\n\n[è¡¥å……] {answer}"
                    restart_worker(new_prompt)
                else:
                    mark_blocked(task_id, content)
                    skip_to_next_task()
        
        case "error":
            if retry_count < 3:
                mark_retry(task_id)
            else:
                mark_failed(task_id)
        
        case "session_end":
            if event["success"]:
                mark_done(task_id)
                update_prd_status(task_id, "âœ… DONE")
            schedule_next_task()
```

### 7.4 é—®é¢˜è¯†åˆ«ç­–ç•¥

ç”±äº Codex ä¸ä¼šæ˜¾å¼æ ‡è®°"é—®é¢˜"ï¼ŒPM éœ€é€šè¿‡è¯­ä¹‰åˆ†æè¯†åˆ«ï¼š

| è¯†åˆ«æ¨¡å¼ | ç¤ºä¾‹ |
|---------|-----|
| ç–‘é—®å¥ | "è¯·é—® XXX åº”è¯¥ç”¨å“ªç§æ–¹å¼ï¼Ÿ" |
| é€‰æ‹©è¯·æ±‚ | "æœ‰ä¸¤ä¸ªé€‰é¡¹ A å’Œ Bï¼Œè¯·ç¡®è®¤" |
| é˜»å¡å£°æ˜ | "æ— æ³•ç»§ç»­ï¼Œå› ä¸ºç¼ºå°‘ XXX ä¿¡æ¯" |
| ç¡®è®¤è¯·æ±‚ | "æ˜¯å¦è¦åˆ é™¤ç°æœ‰æ•°æ®ï¼Ÿ" |

---

## 8. PM è‡ªä¸»å†³ç­–èŒƒå›´

### 8.1 PM å¯è‡ªè¡Œå†³å®šçš„é—®é¢˜

| é—®é¢˜ç±»å‹ | ç¤ºä¾‹ | PM å†³ç­– |
|---------|------|--------|
| æŠ€æœ¯é€‰å‹ (å°) | "ç”¨ async/await è¿˜æ˜¯ .then()?" | é€‰æ‹©æ›´ç°ä»£çš„æ–¹æ¡ˆ |
| å‘½åè§„èŒƒ | "å˜é‡åç”¨ camelCase è¿˜æ˜¯ snake_case?" | éµå¾ªé¡¹ç›®ç°æœ‰è§„èŒƒ |
| å®ç°ç»†èŠ‚ | "ç”¨ Map è¿˜æ˜¯ List?" | æ ¹æ®æ€§èƒ½éœ€æ±‚é€‰æ‹© |
| ç¼ºå¤±ä¾èµ– | "æ‰¾ä¸åˆ° X æ¨¡å—" | æ£€æŸ¥å¹¶æä¾›æ­£ç¡®è·¯å¾„ |

### 8.2 PM å¿…é¡»è¯¢é—® User çš„é—®é¢˜

| é—®é¢˜ç±»å‹ | ç¤ºä¾‹ | å¤„ç†æ–¹å¼ |
|---------|------|----------|
| éœ€æ±‚æ­§ä¹‰ | "ç”¨æˆ·è¯´çš„ 'X' æ˜¯ä»€ä¹ˆæ„æ€?" | æ ‡è®° BLOCKEDï¼Œè¯¢é—® User |
| æ¶æ„å†³ç­– | "éœ€è¦æ–°å¢æ•°æ®åº“è¡¨å—?" | è¯¢é—® User |
| é£é™©æ“ä½œ | "éœ€è¦åˆ é™¤ç°æœ‰æ•°æ®å—?" | å¿…é¡» User ç¡®è®¤ |
| è¶…å‡ºèŒƒå›´ | "è¿™ä¸ªåŠŸèƒ½ä¸åœ¨ PRD ä¸­" | è¯¢é—® User æ˜¯å¦æ‰©å±•èŒƒå›´ |

---

## 9. é˜»å¡ä»»åŠ¡å¤„ç†ç­–ç•¥

å½“ä»»åŠ¡å› ç­‰å¾… User å›å¤è€Œé˜»å¡æ—¶ï¼š

1. **æ ‡è®°çŠ¶æ€**: å°†ä»»åŠ¡æ ‡è®°ä¸º `ğŸš« BLOCKED (ç­‰å¾… User)`
2. **è®°å½•é—®é¢˜**: åœ¨ PRD æˆ– `active_context.md` ä¸­è®°å½•é˜»å¡åŸå› 
3. **è·³è¿‡æ‰§è¡Œ**: æŸ¥æ‰¾ä¸‹ä¸€ä¸ª**æ— ä¾èµ–å…³ç³»**çš„ PENDING ä»»åŠ¡
4. **ç»§ç»­è°ƒåº¦**: æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œç›´åˆ°:
   - æ‰€æœ‰éé˜»å¡ä»»åŠ¡å®Œæˆ
   - æˆ– User å›å¤åæ¢å¤é˜»å¡ä»»åŠ¡

```
ä»»åŠ¡ä¾èµ–å›¾:
  T-001 (DONE)
    â”œâ”€â”€ T-002 (BLOCKED - ç­‰å¾… User)
    â”‚     â””â”€â”€ T-004 (PENDING - è¢« T-002 é˜»å¡)
    â””â”€â”€ T-003 (PENDING - æ— ä¾èµ–) â† PM è·³åˆ°è¿™é‡Œæ‰§è¡Œ
```

---

## 10. ä¸åšä»€ä¹ˆ (Out of Scope v2.0)

- âŒ ä¸æ”¯æŒå¹¶è¡Œæ‰§è¡Œï¼ˆv2.0ï¼Œæœªæ¥å¯æ‰©å±•ï¼‰
- âŒ ä¸æ”¯æŒè·¨é¡¹ç›®ä»»åŠ¡æ´¾å‘
- âŒ ä¸æ”¯æŒ Web UI ç›‘æ§é¢æ¿

---

## 11. é£é™©ä¸æŒ‘æˆ˜

### 11.1 è¿è¡Œæ—¶é£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|-----|------|---------|
| âš ï¸ Worker å¡æ­» | ä»»åŠ¡æ— é™ç­‰å¾… | PM è®¾ç½®è¶…æ—¶ï¼ˆ15åˆ†é’Ÿï¼‰ï¼Œå¼ºåˆ¶ç»ˆæ­¢ |
| âš ï¸ PM è¯¯åˆ¤é—®é¢˜ | å›ç­”é”™è¯¯å¯¼è‡´ä»£ç é—®é¢˜ | PM å¯¹ä¸ç¡®å®šçš„é—®é¢˜æ ‡è®° BLOCKED |
| âš ï¸ é˜»å¡ä»»åŠ¡è¿‡å¤š | æ•´ä½“è¿›åº¦åœæ» | é€šçŸ¥ User æ‰¹é‡å¤„ç†é˜»å¡é—®é¢˜ |
| âš ï¸ Git å†²çª | ä»£ç ä¸¢å¤± | æ¯ä¸ªä»»åŠ¡å®Œæˆåè‡ªåŠ¨ commit |

### 11.2 æŠ€æœ¯é¢„ç ”ä¾èµ– âœ… å·²å®Œæˆ

> âœ… **é¢„ç ”å®Œæˆæ—¶é—´**: 2026-02-09 17:16

| é¢„ç ”é¡¹ | éªŒè¯ç»“è®º | é‡‡ç”¨æ–¹æ¡ˆ |
|-------|---------|---------|
| ğŸ”¬ **Codex CLI äº¤äº’èƒ½åŠ›** | âš ï¸ æœ‰é™ - `exec` æ¨¡å¼ä¸æ”¯æŒè¿è¡Œæ—¶ stdin | âœ… é‡‡ç”¨"é‡å¯æ³¨å…¥"æ–¹æ¡ˆ (ç¬¬ 5.4 èŠ‚å·²æ›´æ–°) |
| ğŸ”¬ **ç»“æ„åŒ–è¾“å‡ºå¯è¡Œæ€§** | âœ… åŸç”Ÿæ”¯æŒ `--json` JSONL äº‹ä»¶æµ | âœ… é‡‡ç”¨åŸç”Ÿ JSONL (ç¬¬ 7 èŠ‚å·²æ›´æ–°) |

**å…³é”®å‘ç°**:
- Codex CLI åŸç”Ÿ `--json` æ¯”è‡ªå®šä¹‰æ ‡ç­¾æ›´å¯é 
- PM éœ€é€šè¿‡è¯­ä¹‰åˆ†æè¯†åˆ« Agent æé—®ï¼Œè€Œéä¾èµ–æ˜¾å¼æ ‡ç­¾

---

## 12. æˆåŠŸæŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | è¯´æ˜ |
|------|------|------|
| **è‡ªåŠ¨åŒ–ç‡** | â‰¥ 80% | æ— éœ€ User ä»‹å…¥å³å¯å®Œæˆçš„ä»»åŠ¡æ¯”ä¾‹ |
| **PM è‡ªä¸»å†³ç­–ç‡** | â‰¥ 70% | Worker é—®é¢˜ç”± PM ç›´æ¥å›ç­”çš„æ¯”ä¾‹ |
| **é˜»å¡æ¢å¤æ—¶é—´** | < 5 åˆ†é’Ÿ | User å›å¤åæ¢å¤æ‰§è¡Œçš„æ—¶é—´ |
| **æ•´ä½“å®Œæˆæ—¶é—´** | 10 ä»»åŠ¡ / 30 åˆ†é’Ÿ | ç«¯åˆ°ç«¯æ•ˆç‡ |

---

**è¯·ç¡®è®¤ä»¥ä¸Šå†…å®¹ï¼Œè¯´ "Go" è¿›å…¥æŠ€æœ¯è¯„å®¡**
